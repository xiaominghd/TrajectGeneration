# TrajectoryGeneration
如何挖掘出人群移动模式并基于实时外部环境进行轨迹仿真
## **一些想法**
### **相关工作**
---
#### * 基于gan的轨迹生成
   ##### * [**seqgan**](https://ojs.aaai.org/index.php/AAAI/article/view/10804)
   使用gan模型进行轨迹生成
   * word_embeeding 没有捕获轨迹点本身的空间信息，更不谈移动模式了
   * 只能做到粗粒度固定时间间隔的轨迹生成，grid-grid，精度不够，可修改性差
   * 不能保证生成的轨迹整体满足区域流量的分布
   
   #####  * [**movsim**](https://dl.acm.org/doi/abs/10.1145/3394486.3412862)
   同样是做了序列生成，不同的是在生成器部分加入了地理信息的矩阵
   * 加入了空间信息，使得整个模型从一个文本生成任务变得更像是轨迹生成任务
   * 加入了蒙特卡洛搜索进行采样，尽可能让生成轨迹的分布=真实轨迹的分布
   * 分别在距离、半径、停留时间等指标上用了生成轨迹与真实轨迹的差异，再一次强调了作者想要生成的**真实**轨迹。
   * 空间信息是用于生成器做下一点预测，如果纯粹是markov模型，由于人行为不同/时间不同，转移的概率也不尽相同，所以算是丢掉了时间信息
   * 在判别器中并没有用上空间信息
   
   ##### * [**STG**](https://www.jds-online.com/files/JDS202001-08.pdf)
   使用两个gan来进行细粒度的生成，目标是在基于grid生成的基础上进一步的加入空间信息，进行更细粒度的生成
   * **使用了一种循序渐近的方法**，将精细化轨迹生成拆分成为两个子任务，分别完成模型的训练
   * 所做的工作大部分是在把轨迹点映射到路网上，使用了cv的方法，其实走了一些弯路
   * 可能并没有花太多时间在时间信息上，评价指标也只和空间信息有关
   
   ##### GAN解释性差，难训练
#### * 其他生成
   ##### * **HMM**
   使用隐马尔可夫链进行做生成
   * 引入了 **隐状态** 这一概念
   * 使用纯统计学的方法之间算隐状态之间的K步转移概率，不可说
   
   ##### * **SVAE**
   使用变分自编码器做生成 **轨迹-Encoder-隐状态-Decoder-轨迹**
   * 高维轨迹映射到低维隐状态能够对轨迹继续分类，实现了对于移动模式的识别
   * 仍然是做sequence生成，没有空间信息
   * 如果输入整条轨迹训练隐状态，会加入大量的噪声，使得隐状态不能很好的表征轨迹类型
   
   ##### * **诗歌生成**
   使用RNN进行循环生成
   * 除了词库以外（相当于轨迹生成中的轨迹点），模型还接受了主题词这一**外部输入**，不再进行随机生成
   * 一次性生成整首诗可能会造成误差累积，造成生成结果越来越偏
   * 诗歌生成由于句间约束较少，只能够保证生成结果不要偏离上一句的主题，最后在保证音律规整的前提下退化为堆词的排比句
---
### **一些构想**
---
#### 1、 轨迹由*日常轨迹+实时轨迹* 两个部分构成，日常轨迹与人的移动模式决定，实时轨迹与外部环境决定
#### 2、 对于*日常轨迹* 子任务，先将轨迹点按照时间维度进行聚合成为“停留点-移动-停留点”的形式，结合空间信息POI分布等，通过VAE学习隐状态，在隐状态中完成粗粒度生成
#### 3、 对于*实时轨迹* 子任务，学习当下流量移动分布，在停留点间进行精细化的轨迹生成
#### 4、 通过由实时轨迹对日常轨迹进行微调  
    例如：有一条简单的轨迹为“北邮-北邮-北邮-北邮-北邮-北邮-上地-西二旗-中关村-中关村-中关村-中关村-中关村-中关村-西二旗-西土城-北邮-北邮-北邮”
    * step1 生成“北邮-中关村-北邮”
    * step2 根据实时流量在“北邮-中关村”之间生成“上地-西二旗”，在“中关村-北邮”之间生成“中关村-西二旗-西土城”
    * step3 实时轨迹对日常轨迹进行
---
### **所以到底有什么新的**
---
#### 1、首次尝试从轨迹中挖掘了人在时间/空间范围里的移动模式
#### 2、实时轨迹提供了轨迹与流量的交互，将区域间的通勤流量作为外部输入，使得生成的轨迹既能够满足区域流量分布，也能够满足区域间通勤流量规律。
#### 3、用实时轨迹去微调日常轨迹，实现了细粒度的轨迹生成。
---
### **简单模型**
---
字也太丑了
![56A4F124E1D8BC8F5EE5F3D876198267](https://user-images.githubusercontent.com/33551862/167651390-16f974ce-d2f7-4bdc-b09f-51a3365c1a24.png)
#### * 模型主要分为三个部分
#### 1、加入空间特征值之后使用VAE完成日常部分的生成
#### 2、根据流量分布预测通勤流量，作为后续路径规划的参考，通勤流量不会是预测到非常细粒度的时间例如“上午”“下午”“晚上”的粒度
#### 3、将通勤流量通过一个FC，学得每一段路的通勤时间，作为后续微调日常轨迹的标准
#### 4、加上距离信息，使用深度优先搜索进行路径规划（不确定这里是应该用深度学习的方法去学路径，还是用非深度的方法直接用DFS搜索）
#### 5、对日常流量进行微调
---
### **数据集**
---
#### **要求**
* 数据集要求：数据量/区域范围不能太小，否则根据流量分布生成非日常轨迹将不会起到太大的作用
* 采样间隔不能太大，否则不能生成细粒度的轨迹
* 尽可能能够有多种类型的人群参与其中，比如有学生、上班族、游客，使得移动模式之间的差距尽可能大

#### **可用数据集**
   ##### **Porto Trajectory Dataset**
   * 包含了170w条出租车通行的轨迹数据，采样间隔15s一个点
   * 由于是出租车数据，有“上客-下客”的OD对标识，能够省去大量的对数据预处理的工作，能够更好的识别移动模式
   * 使用该数据集的模型：TSG
   
   ##### **海南CDR数据集**
   *  采样的密度足够细。区域范围有限。
   *  能够根据游客所访问的点将轨迹划分为不同的隐状态：例如亲子游、老年游等
   *  有大量的可以利用的流量分布信息，进行实时轨迹的生成
  
#### **一些存在的问题**
* 模型到底是生成什么粒度的轨迹，是网格还是空间图，如果是图的话，怎么建图
* 生成日常轨迹需要加入地理信息输入到VAE中，并且生成带有时间信息的停止点序列。是用多输入还是用graphEmbedding
* 流量的空间分布如何决定采样的比例
* 实时轨迹生成过程中需要考虑当前的通勤流量，通勤流量又被建模成了预测问题。通勤流量如何在影响在已知OD对前提下的路径规划
* 如何结合两个模型，即是根据通勤时间进行微调
* wating for exploring...
---
## 论文阅读笔记
---
### 基于gan的轨迹生成


#### * seqgan
基于gan的序列生成模型，生成器和判别器都使用**LSTM**。使用预测任务预训练生成器，使用分类任务预训练判别器。在对抗训练的过程中引入了强化学习的**policy gradient**
![image](https://user-images.githubusercontent.com/33551862/167591398-f62d7e1f-fc36-4723-8716-6fcaf1ff85bd.png)


* movsim
